/*
$.panorama version 1.0
by danyagrohman@gmail.com
*/
(function(c){function l(d,f){this.defaults={debug:!1,clickedWrapperClass:"ui-panorama-click-wrapper",clickedElementClass:"ui-panorama-clicked",animationDuration:500,animationEasing:"easeOutExpo",titleSelector:"h1",itemsContainerSelector:".ui-panorama-items",itemSelector:".ui-panorama-item",backgroundAnimationStep:0,titleAnimationStep:15,itemsGapPercentage:10,itemsLeftMarginPercent:0,totalNumberOfItems:0,controlInitializedEventName:"controlInitialized",selectedItemChangedEventName:"selectedItemChanged"};
if(c(d).data("panorama"))return!1;this.opts=c.extend({},this.defaults,f);this.opts=c.extend(this.opts,{currentIndex:0,busy:!1,_item_width:0,eventsSettings:{useSetReleaseCapture:!1,lastXYById:{},moved:0,yDirection:null},debug:!0==this.opts.debug&&c("<div>").css({position:"fixed",bottom:"0px",right:"0px",background:"white",border:"1px solid red",overflow:"hidden",width:"200px",height:"20%",zIndex:"9999",color:"black"}).appendTo("body")});0==parseInt(this.opts.backgroundAnimationStep)&&(this.opts.backgroundAnimationStep=
Math.round(100/c(d).find(this.opts.itemSelector).length));0==parseInt(this.opts.totalNumberOfItems)&&(this.opts.totalNumberOfItems=c(d).find(this.opts.itemSelector).length);this.$el=c(d);c("<div>").addClass(this.opts.clickedWrapperClass).css({zIndex:999,opacity:"0",width:c(window).width(),height:c(window).height(),position:"fixed",left:"0px",top:"0px",background:"black"}).prependTo(this.$el);if(this.opts.debug){var g=c("<div>").css({position:"fixed",bottom:"0px",left:"0px",background:"white",border:"1px solid red",
color:"black"}).appendTo("body");c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToNext();\">swipe left</a>").appendTo(g);c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToPrevious();\">swipe right</a>").appendTo(g);c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goTo(3);\">go to screen 3</a>").appendTo(g);c("<h2>").html('<a href="#" onclick="alert($(\'.'+this.$el.attr("class")+"').data('obj').opts.currentIndex);\">get current idx</a>").appendTo(g)}this.getItemsContainer=
function(){return this.$el.children(this.opts.itemsContainerSelector)};this.getItems=function(){return this.getItemsContainer().children(this.opts.itemSelector)};this.getItem=function(b){return this.getItemsContainer().children(this.opts.itemSelector+":eq("+b+")")};this.getLastItem=function(){return this.getItem(this.opts.totalNumberOfItems-1)};this.getTitle=function(){return this.$el.children(this.opts.titleSelector)};this.fixIndex=function(b){0>b?b+=this.opts.totalNumberOfItems:b>=this.opts.totalNumberOfItems&&
(b-=this.opts.totalNumberOfItems);return b};this.getCurrentItem=function(){return this.getItems().eq(this.opts.currentIndex)};this.goTo=function(b){var e=this,a=setInterval(function(){e.opts.currentIndex==b?clearInterval(a):e.opts.currentIndex<b?e.goToNext():e.goToPrevious()},e.opts.animationDuration)};this.goToNext=function(){this.changeItem(!0)};this.goToPrevious=function(){this.changeItem(!1)};this.setEvents=function(b){function e(h){if(!("mousemove"==h.type&&0==a.NumberOfKeys(a.opts.eventsSettings.lastXYById))){h.preventDefault&&
h.preventDefault();h.preventManipulation&&h.preventManipulation();h.preventMouseEvent&&h.preventMouseEvent();for(var g=h.changedTouches?h.changedTouches:[h],l=0;l<g.length;++l){var m=g[l],k="undefined"!=typeof m.identifier?m.identifier:"undefined"!=typeof m.pointerId?m.pointerId:1;a.EnsurePageXY(m);var n=m.pageX,m=m.pageY;if(h.type.match(/(start|down)$/i)){a.opts.eventsSettings.moved=0;documentToTargetDelta=a.ComputeDocumentToElementDelta(b);if(a.opts.eventsSettings.lastXYById[k]){delete a.opts.eventsSettings.lastXYById[k];
a.opts.debug&&c("<div>").html("force end").prependTo(a.opts.debug);a.getItemsContainer().animate({left:"0px"});break}a.opts.debug&&c("<div>").html("start at "+n+"px").prependTo(a.opts.debug);a.opts.eventsSettings.lastXYById[k]={x:n,y:m};p=n;f=m;b.msSetPointerCapture?b.msSetPointerCapture(k):"mousedown"==h.type&&1==a.NumberOfKeys(a.opts.eventsSettings.lastXYById)&&(a.opts.eventsSettings.useSetReleaseCapture?b.setCapture(!0):(document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",
e,!1)));c("."+a.opts.clickedWrapperClass).hide();c(document.elementFromPoint(n,m)).addClass(a.opts.clickedElementClass);c("."+a.opts.clickedWrapperClass).show()}else if(h.type.match(/move$/i))void 0!==a.opts.eventsSettings.lastXYById[k]&&(a.opts.eventsSettings.lastXYById[k].x=n,a.opts.eventsSettings.lastXYById[k].y=m,d=n-p,j=f-m,k=20,10<Math.abs(j)?(0<j&&"up"!=a.opts.eventsSettings.yDirection?(j-=20,a.opts.eventsSettings.yDirection="down"):a.opts.eventsSettings.yDirection="up",!1==a.opts.busy&&(j+=
a.getItem(a.opts.currentIndex).scrollTop(),f+=a.getItem(a.opts.currentIndex).scrollTop()),a.opts.busy=!0,a.getItem(a.opts.currentIndex).scrollTop(j),a.opts.eventsSettings.moved=j,a.opts.debug&&c("<div>").html("going "+a.opts.eventsSettings.yDirection).prependTo(a.opts.debug),d=0):Math.abs(d)>k?(0>d&&(k=-k),a.opts.eventsSettings.moved=d-k,a.opts.debug&&c("<div>").html("move: "+a.opts.eventsSettings.moved+"px").prependTo(a.opts.debug),a.getItemsContainer().css("left",a.opts.eventsSettings.moved+"px")):
(j=d=0,a.opts.eventsSettings.moved=0));else if(a.opts.eventsSettings.lastXYById[k]&&h.type.match(/(up|end|cancel)$/i)){a.opts.debug&&c("<div>").html("end").prependTo(a.opts.debug);0!=j&&void 0!==j&&(a.opts.eventsSettings.yDirection=null,a.opts.busy=!1);var q=setInterval(function(){!1==a.opts.busy&&clearInterval(q);0<d?a.goToPrevious():0>d&&a.goToNext();d=0},10);delete a.opts.eventsSettings.lastXYById[k];b.msReleasePointerCapture?b.msReleasePointerCapture(k):"mouseup"==h.type&&0==a.NumberOfKeys(a.opts.eventsSettings.lastXYById)&&
(a.opts.eventsSettings.useSetReleaseCapture?b.releaseCapture():(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",e,!1)));setTimeout(function(){c("."+a.opts.clickedElementClass).each(function(){c(this).removeClass(a.opts.clickedElementClass);(0==a.opts.eventsSettings.moved||void 0===a.opts.eventsSettings.moved)&&c(this).click()})},100)}}}}var a=this;if(window.navigator.msPointerEnabled)b.addEventListener("MSPointerDown",e,!1),b.addEventListener("MSPointerMove",
e,!1),b.addEventListener("MSPointerUp",e,!1),b.addEventListener("MSPointerCancel",e,!1),"undefined"!=typeof b.style.msContentZooming&&(b.style.msContentZooming="none"),"undefined"!=typeof b.style.msTouchAction&&(b.style.msTouchAction="none"),a.opts.debug&&c("<div>").html("Using Microsoft pointer model").prependTo(a.opts.debug);else if(b.addEventListener)b.addEventListener("touchstart",e,!1),b.addEventListener("touchmove",e,!1),b.addEventListener("touchend",e,!1),b.addEventListener("touchcancel",e,
!1),b.addEventListener("mousedown",e,!1),b.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(this.opts.eventsSettings.useSetReleaseCapture=!0,b.addEventListener("mousemove",e,!1),b.addEventListener("mouseup",e,!1)),a.opts.debug&&c("<div>").html("Using mouse model with capture").prependTo(a.opts.debug);else if(b.attachEvent&&b.setCapture)opts.eventsSettings.useSetReleaseCapture=!0,b.attachEvent("onmousedown",function(){e(window.event);return window.event.returnValue=!1}),b.attachEvent("onmousemove",
function(){e(window.event);return window.event.returnValue=!1}),b.attachEvent("onmouseup",function(){e(window.event);return window.event.returnValue=!1}),a.opts.debug&&c("<div>").html("Using legacy IE mode - mouse model with capture").prependTo(a.opts.debug);else return a.opts.debug&&c("<div>").html("Unexpected combination of supported features").prependTo(a.opts.debug),!1;var p,d,f,j;this.$el.data("obj",a);this.$el.trigger(a.opts.controlInitializedEventName);return!0};this.EnsurePageXY=function(b){if("undefined"==
typeof b.pageX)if(b.pageX=b.offsetX+documentToTargetDelta.x,b.pageY=b.offsetY+documentToTargetDelta.y,b.srcElement.offsetParent==target&&document.documentMode&&8==document.documentMode&&"mousedown"==b.type)b.pageX+=b.srcElement.offsetLeft,b.pageY+=b.srcElement.offsetTop;else if(b.srcElement!=target&&!document.documentMode||8>document.documentMode){for(var e=-2,a=-2,c=b.srcElement;null!=c;c=c.parentNode)e+=c.scrollLeft?c.scrollLeft:0,a+=c.scrollTop?c.scrollTop:0;b.pageX=b.clientX+e;b.pageY=b.clientY+
a}};this.NumberOfKeys=function(b){if(Object.keys)return Object.keys(b).length;var c=0,a;for(a in b)++c;return c};this.ComputeDocumentToElementDelta=function(b){for(var c=0,a=0;null!=b;b=b.offsetParent){if(!navigator.userAgent.match(/\bMSIE\b/)||document.documentMode&&!(8>document.documentMode)||!("relative"==b.currentStyle.position&&b.offsetParent&&"relative"==b.offsetParent.currentStyle.position&&b.offsetLeft==b.offsetParent.offsetLeft))c+=b.offsetLeft;a+=b.offsetTop}return{x:c,y:a}};this.changeItem=
function(b){if(this.opts.busy)return!1;this.opts.busy=!0;this.opts.debug&&(b?c("<div>").html("swipe left").prependTo(this.opts.debug):c("<div>").html("swipe right").prependTo(this.opts.debug));var e,a,d=this.getItem(this.opts.currentIndex);a=this.fixIndex(b?this.opts.currentIndex+1:this.opts.currentIndex-1);e=this.fixIndex(b?this.opts.currentIndex+2:this.opts.currentIndex+1);var f=this.getItem(a),g=2<this.totalNumberOfItems?this.getItem(e):void 0,j,h;!b&&f&&(f.css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent}),
3<this.totalNumberOfItems&&(j=this.fixIndex(a-1),h=this.getItem(j),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+a+")").not(":eq("+j+")").hide(),this.getItem(this.fixIndex(a-1)).css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent})));b&&g&&(g.css({left:2*this.opts._item_width+this.opts.itemsLeftMarginPercent}),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+e+")").hide());b={left:(b?"-=":"+=")+this.opts._item_width};var l=this;e=function(){l.opts.currentIndex=
a;l.opts.busy=!1;h&&h.show();l.$el.trigger(l.opts.selectedItemChangedEventName)};f&&f.show();g&&g.show();f&&f.animate(b,this.opts.animationDuration,this.opts.animationEasing,e);g&&g.animate(b,this.opts.animationDuration,this.opts.animationEasing);d.animate(b,this.opts.animationDuration,this.opts.animationEasing);this.getItemsContainer().animate({left:"0px"},this.opts.anumationDuration,this.opts.animationEasing);this.opts.titleSelector&&this.getTitle().animate({marginLeft:-a*this.opts.titleAnimationStep+
"%"},this.opts.animationDuration,this.opts.animationEasing);this.$el.animate({backgroundPositionX:a*this.opts.backgroundAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);return!0}}l.prototype={init:function(){return this.$el?(this.$el.attr("data-panorama",!0),this.prepare(this.$el),!0):!1},prepare:function(d){var f=d.parent().height()+1,g=this.getItemsContainer().position().top,b=f-g;d.height(b);this.getItemsContainer().height(b);this.totalNumberOfItems=this.getItems().length;
var e=d.outerWidth()*(100-this.opts.itemsGapPercentage)/100;this.opts._item_width=e;d=Math.round(c(window).width()/100*this.opts.itemsLeftMarginPercent);this.opts.itemsLeftMarginPercent=d;this.getItems().each(function(a,d){c(d).height(b-(c(d).outerHeight()-c(d).height()));c(d).width(e-(c(d).outerWidth()-c(d).width()));1==a&&c(d).css({left:e});1<a&&c(d).hide()});2<this.opts.totalNumberOfItems&&(this.getLastItem().css({left:"-"+e+"px"}).show(),this.getItems().css("left","+="+d+"px"))},show:function(){var d=
this;this.getItemsContainer().fadeIn(function(){var f=d.getItemsContainer().position().top;d.getItems().each(function(){c(this).css("height","-="+f+"px")})})}};c.fn.panorama=function(d){this.length&&this.each(function(){var f=new l(this,d);f.init()&&(f.setEvents(this),f.show(),c(this).data("panorama",f))})}})(jQuery);$.easing.easeOutExpo=function(c,l,d,f,g){return l==g?d+f:f*(-Math.pow(2,-10*l/g)+1)+d};