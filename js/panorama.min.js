/*
$.panorama version 1.0
by danyagrohman@gmail.com
*/
(function(d){function k(e,f){this.defaults={debug:!1,animationDuration:500,animationEasing:"easeOutExpo",titleSelector:"h1",itemsContainerSelector:".ui-panorama-items",itemSelector:".ui-panorama-item",backgroundAnimationStep:0,titleAnimationStep:15,itemsGapPercentage:10,itemsLeftMarginPercent:0,totalNumberOfItems:0,controlInitializedEventName:"controlInitialized",selectedItemChangedEventName:"selectedItemChanged"};if(d(e).data("panorama"))return!1;this.opts=d.extend({},this.defaults,f);this.opts=
d.extend(this.opts,{currentIndex:0,busy:!1,_item_width:0,eventsSettings:{useSetReleaseCapture:!1,lastXYById:{}},debug:!0==this.opts.debug&&d("<div>").css({position:"fixed",bottom:"0px",right:"0px",background:"white",border:"1px solid red",overflow:"hidden",width:"200px",height:"20%",zIndex:"9999",color:"black"}).appendTo("body")});0==parseInt(this.opts.backgroundAnimationStep)&&(this.opts.backgroundAnimationStep=Math.round(100/d(e).find(this.opts.itemSelector).length));0==parseInt(this.opts.totalNumberOfItems)&&
(this.opts.totalNumberOfItems=d(e).find(this.opts.itemSelector).length);this.$el=d(e);if(this.opts.debug){var h=d("<div>").css({position:"fixed",bottom:"0px",left:"0px",background:"white",border:"1px solid red",color:"black"}).appendTo("body");d("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToNext();\">swipe left</a>").appendTo(h);d("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToPrevious();\">swipe right</a>").appendTo(h);
d("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goTo(3);\">go to screen 3</a>").appendTo(h);d("<h2>").html('<a href="#" onclick="alert($(\'.'+this.$el.attr("class")+"').data('obj').opts.currentIndex);\">get current idx</a>").appendTo(h)}this.getItemsContainer=function(){return this.$el.children(this.opts.itemsContainerSelector)};this.getItems=function(){return this.getItemsContainer().children(this.opts.itemSelector)};this.getItem=function(a){return this.getItemsContainer().children(this.opts.itemSelector+
":eq("+a+")")};this.getLastItem=function(){return this.getItem(this.opts.totalNumberOfItems-1)};this.getTitle=function(){return this.$el.children(this.opts.titleSelector)};this.fixIndex=function(a){0>a?a+=this.opts.totalNumberOfItems:a>=this.opts.totalNumberOfItems&&(a-=this.opts.totalNumberOfItems);return a};this.getCurrentItem=function(){return this.getItems().eq(this.opts.currentIndex)};this.goTo=function(a){var c=this,b=setInterval(function(){c.opts.currentIndex==a?clearInterval(b):c.opts.currentIndex<
a?c.goToNext():c.goToPrevious()},c.opts.animationDuration)};this.goToNext=function(){this.changeItem(!0)};this.goToPrevious=function(){this.changeItem(!1)};this.setEvents=function(a){function c(g){if(!("mousemove"==g.type&&0==b.NumberOfKeys(b.opts.eventsSettings.lastXYById))){g.preventDefault&&g.preventDefault();g.preventManipulation&&g.preventManipulation();g.preventMouseEvent&&g.preventMouseEvent();for(var f=g.changedTouches?g.changedTouches:[g],h=0;h<f.length;++h){var l=f[h],j="undefined"!=typeof l.identifier?
l.identifier:"undefined"!=typeof l.pointerId?l.pointerId:1;b.EnsurePageXY(l);var k=l.pageX,l=l.pageY;if(g.type.match(/(start|down)$/i))documentToTargetDelta=b.ComputeDocumentToElementDelta(a),b.opts.eventsSettings.lastXYById[j]&&(delete b.opts.eventsSettings.lastXYById[j],b.opts.debug&&d("<div>").html("end").prependTo(b.opts.debug)),b.opts.debug&&d("<div>").html("start at "+k+"px").prependTo(b.opts.debug),b.opts.eventsSettings.lastXYById[j]={x:k,y:l},m=k,a.msSetPointerCapture?a.msSetPointerCapture(j):
"mousedown"==g.type&&1==b.NumberOfKeys(b.opts.eventsSettings.lastXYById)&&(b.opts.eventsSettings.useSetReleaseCapture?a.setCapture(!0):(document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",c,!1)));else if(g.type.match(/move$/i))b.opts.eventsSettings.lastXYById[j].x=k,b.opts.eventsSettings.lastXYById[j].y=l,e=k-m,j=20,Math.abs(e)>j?(0>e&&(j=-j),j=e-j,b.opts.debug&&d("<div>").html("move: "+j+"px").prependTo(b.opts.debug),b.getItemsContainer().css("left",j+"px")):e=0;else if(b.opts.eventsSettings.lastXYById[j]&&
g.type.match(/(up|end|cancel)$/i)){b.opts.debug&&d("<div>").html("end").prependTo(b.opts.debug);var n=setInterval(function(){!1==b.opts.busy&&clearInterval(n);0<e?b.goToPrevious():0>e&&b.goToNext();e=0},10);delete b.opts.eventsSettings.lastXYById[j];a.msReleasePointerCapture?a.msReleasePointerCapture(j):"mouseup"==g.type&&0==b.NumberOfKeys(b.opts.eventsSettings.lastXYById)&&(b.opts.eventsSettings.useSetReleaseCapture?a.releaseCapture():(document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",
c,!1)))}}}}var b=this;if(window.navigator.msPointerEnabled)a.addEventListener("MSPointerDown",c,!1),a.addEventListener("MSPointerMove",c,!1),a.addEventListener("MSPointerUp",c,!1),a.addEventListener("MSPointerCancel",c,!1),"undefined"!=typeof a.style.msContentZooming&&(a.style.msContentZooming="none"),"undefined"!=typeof a.style.msTouchAction&&(a.style.msTouchAction="none"),b.opts.debug&&d("<div>").html("Using Microsoft pointer model").prependTo(b.opts.debug);else if(a.addEventListener)a.addEventListener("touchstart",
c,!1),a.addEventListener("touchmove",c,!1),a.addEventListener("touchend",c,!1),a.addEventListener("touchcancel",c,!1),a.addEventListener("mousedown",c,!1),a.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(this.opts.eventsSettings.useSetReleaseCapture=!0,a.addEventListener("mousemove",c,!1),a.addEventListener("mouseup",c,!1)),b.opts.debug&&d("<div>").html("Using mouse model with capture").prependTo(b.opts.debug);else if(a.attachEvent&&a.setCapture)opts.eventsSettings.useSetReleaseCapture=
!0,a.attachEvent("onmousedown",function(){c(window.event);return window.event.returnValue=!1}),a.attachEvent("onmousemove",function(){c(window.event);return window.event.returnValue=!1}),a.attachEvent("onmouseup",function(){c(window.event);return window.event.returnValue=!1}),b.opts.debug&&d("<div>").html("Using legacy IE mode - mouse model with capture").prependTo(b.opts.debug);else return b.opts.debug&&d("<div>").html("Unexpected combination of supported features").prependTo(b.opts.debug),!1;var m,
e;this.$el.data("obj",b);this.$el.trigger(b.opts.controlInitializedEventName);return!0};this.EnsurePageXY=function(a){if("undefined"==typeof a.pageX)if(a.pageX=a.offsetX+documentToTargetDelta.x,a.pageY=a.offsetY+documentToTargetDelta.y,a.srcElement.offsetParent==target&&document.documentMode&&8==document.documentMode&&"mousedown"==a.type)a.pageX+=a.srcElement.offsetLeft,a.pageY+=a.srcElement.offsetTop;else if(a.srcElement!=target&&!document.documentMode||8>document.documentMode){for(var c=-2,b=-2,
d=a.srcElement;null!=d;d=d.parentNode)c+=d.scrollLeft?d.scrollLeft:0,b+=d.scrollTop?d.scrollTop:0;a.pageX=a.clientX+c;a.pageY=a.clientY+b}};this.NumberOfKeys=function(a){if(Object.keys)return Object.keys(a).length;var c=0,b;for(b in a)++c;return c};this.ComputeDocumentToElementDelta=function(a){for(var c=0,b=0;null!=a;a=a.offsetParent){if(!navigator.userAgent.match(/\bMSIE\b/)||document.documentMode&&!(8>document.documentMode)||!("relative"==a.currentStyle.position&&a.offsetParent&&"relative"==a.offsetParent.currentStyle.position&&
a.offsetLeft==a.offsetParent.offsetLeft))c+=a.offsetLeft;b+=a.offsetTop}return{x:c,y:b}};this.changeItem=function(a){if(this.opts.busy)return!1;this.opts.busy=!0;this.opts.debug&&(a?d("<div>").html("swipe left").prependTo(this.opts.debug):d("<div>").html("swipe right").prependTo(this.opts.debug));var c,b,e=this.getItem(this.opts.currentIndex);b=this.fixIndex(a?this.opts.currentIndex+1:this.opts.currentIndex-1);c=this.fixIndex(a?this.opts.currentIndex+2:this.opts.currentIndex+1);var f=this.getItem(b),
g=2<this.totalNumberOfItems?this.getItem(c):void 0,h,k;!a&&f&&(f.css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent}),3<this.totalNumberOfItems&&(h=this.fixIndex(b-1),k=this.getItem(h),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+b+")").not(":eq("+h+")").hide(),this.getItem(this.fixIndex(b-1)).css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent})));a&&g&&(g.css({left:2*this.opts._item_width+this.opts.itemsLeftMarginPercent}),this.getItems().not(":eq("+
this.opts.currentIndex+")").not(":eq("+c+")").hide());a={left:(a?"-=":"+=")+this.opts._item_width};f&&f.show();g&&g.show();var l=this;f&&f.animate(a,this.opts.animationDuration,this.opts.animationEasing,function(){l.opts.currentIndex=b;l.opts.busy=!1;k&&k.show();l.$el.trigger(l.opts.selectedItemChangedEventName)});g&&g.animate(a,this.opts.animationDuration,this.opts.animationEasing);e.animate(a,this.opts.animationDuration,this.opts.animationEasing);this.getItemsContainer().animate({left:"0px"},this.opts.anumationDuration,
this.opts.animationEasing);this.opts.titleSelector&&this.getTitle().animate({marginLeft:-b*this.opts.titleAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);this.$el.animate({backgroundPositionX:b*this.opts.backgroundAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);return!0}}k.prototype={init:function(){return this.$el?(this.$el.attr("data-panorama",!0),this.prepare(this.$el),!0):!1},prepare:function(e){var f=e.parent().height()+1,h=this.getItemsContainer().position().top,
a=f-h;e.height(a);this.getItemsContainer().height(a);this.totalNumberOfItems=this.getItems().length;var c=e.outerWidth()*(100-this.opts.itemsGapPercentage)/100;this.opts._item_width=c;e=Math.round(d(window).width()/100*this.opts.itemsLeftMarginPercent);this.opts.itemsLeftMarginPercent=e;this.getItems().each(function(b,e){d(e).height(a-(d(e).outerHeight()-d(e).height()));d(e).width(c-(d(e).outerWidth()-d(e).width()));1==b&&d(e).css({left:c});1<b&&d(e).hide()});2<this.opts.totalNumberOfItems&&(this.getLastItem().css({left:"-"+
c+"px"}).show(),this.getItems().css("left","+="+e+"px"))},show:function(){var e=this;this.getItemsContainer().fadeIn(function(){var f=e.getItemsContainer().position().top;e.getItems().each(function(){d(this).css("height","-="+f+"px")})})}};d.fn.panorama=function(e){this.length&&this.each(function(){var f=new k(this,e);f.init()&&(f.setEvents(this),f.show(),d(this).data("panorama",f))})}})(jQuery);$.easing.easeOutExpo=function(d,k,e,f,h){return k==h?e+f:f*(-Math.pow(2,-10*k/h)+1)+e};