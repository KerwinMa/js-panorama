/*
$.panorama version 1.0
by danyagrohman@gmail.com
*/
(function(c){function k(f,e){this.defaults={debug:!1,animationDuration:500,animationEasing:"easeOutExpo",titleSelector:"h1",itemsContainerSelector:".ui-panorama-items",itemSelector:".ui-panorama-item",backgroundAnimationStep:0,titleAnimationStep:15,itemsGapPercentage:10,itemsLeftMarginPercent:0,controlInitializedEventName:"controlInitialized",selectedItemChangedEventName:"selectedItemChanged"};this.opts=c.extend({},this.defaults,e);this.opts=c.extend(this.opts,{currentIndex:0,busy:!1,backgroundAnimationStep:0==
this.opts.backgroundAnimationStep&&Math.round(100/c(f).find(this.opts.itemSelector).length),totalNumberOfItems:c(f).find(this.opts.itemSelector).length,_item_width:0,eventsSettings:{useSetReleaseCapture:!1,lastXYById:{}},debug:!0==this.opts.debug&&c("<div>").css({position:"fixed",bottom:"0px",right:"0px",background:"white",border:"1px solid red",overflow:"hidden",width:"200px",height:"20%",zIndex:"9999"}).appendTo("body")});if(this.opts.debug){var h=c("<div>").css({position:"fixed",bottom:"0px",left:"0px",
background:"white",border:"1px solid red"}).appendTo("body");c("<h2>").html("<a href=\"#\" onclick=\"$('.ui-panorama').data('obj').goToNext();\">swipe left</a>").appendTo(h);c("<h2>").html("<a href=\"#\" onclick=\"$('.ui-panorama').data('obj').goToPrevious();\">swipe right</a>").appendTo(h);c("<h2>").html("<a href=\"#\" onclick=\"$('.ui-panorama').data('obj').goTo(3);\">go to screen 3</a>").appendTo(h);c("<h2>").html("<a href=\"#\" onclick=\"alert($('.ui-panorama').data('obj').opts.currentIndex);\">get current idx</a>").appendTo(h)}this.$el=
c(f);this.getItemsContainer=function(){return this.$el.children(this.opts.itemsContainerSelector)};this.getItems=function(){return this.getItemsContainer().children(this.opts.itemSelector)};this.getItem=function(a){return this.getItemsContainer().children(this.opts.itemSelector+":eq("+a+")")};this.getLastItem=function(){return this.getItem(this.opts.totalNumberOfItems-1)};this.getTitle=function(){return this.$el.children(this.opts.titleSelector).first()};this.fixIndex=function(a){0>a?a+=this.opts.totalNumberOfItems:
a>=this.opts.totalNumberOfItems&&(a-=this.opts.totalNumberOfItems);return a};this.getCurrentItem=function(){return this.getItems().eq(this.opts.currentIndex)};this.goTo=function(a){var d=this,b=setInterval(function(){d.opts.currentIndex==a?clearInterval(b):d.opts.currentIndex<a?d.goToNext():d.goToPrevious()},d.opts.animationDuration)};this.goToNext=function(){this.changeItem(!0)};this.goToPrevious=function(){this.changeItem(!1)};this.setEvents=function(a){function d(g){if(!("mousemove"==g.type&&0==
b.NumberOfKeys(b.opts.eventsSettings.lastXYById))){g.preventDefault&&g.preventDefault();g.preventManipulation&&g.preventManipulation();g.preventMouseEvent&&g.preventMouseEvent();for(var e=g.changedTouches?g.changedTouches:[g],h=0;h<e.length;++h){var j=e[h],l="undefined"!=typeof j.identifier?j.identifier:"undefined"!=typeof j.pointerId?j.pointerId:1;b.EnsurePageXY(j);var k=j.pageX,j=j.pageY;if(g.type.match(/(start|down)$/i))documentToTargetDelta=b.ComputeDocumentToElementDelta(a),b.opts.eventsSettings.lastXYById[l]&&
(delete b.opts.eventsSettings.lastXYById[l],b.opts.debug&&c("<div>").html("end move").prependTo(b.opts.debug)),b.opts.debug&&c("<div>").html("start move at "+k+"px").prependTo(b.opts.debug),b.opts.eventsSettings.lastXYById[l]={x:k,y:j},f=k,a.msSetPointerCapture?a.msSetPointerCapture(l):"mousedown"==g.type&&1==b.NumberOfKeys(b.opts.eventsSettings.lastXYById)&&(b.opts.eventsSettings.useSetReleaseCapture?a.setCapture(!0):(document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",
d,!1)));else if(g.type.match(/move$/i))b.opts.eventsSettings.lastXYById[l].x=k,b.opts.eventsSettings.lastXYById[l].y=j,m=k-f,20<Math.abs(m)?(b.opts.debug&&c("<div>").html("touch move: "+m+"px").prependTo(b.opts.debug),b.getItemsContainer().css("left",m+20+"px")):m=0;else if(b.opts.eventsSettings.lastXYById[l]&&g.type.match(/(up|end|cancel)$/i)){b.opts.debug&&c("<div>").html("end move").prependTo(b.opts.debug);var n=setInterval(function(){!1==b.opts.busy&&clearInterval(n);0<m?b.goToPrevious():0>m&&
b.goToNext();m=0},10);delete b.opts.eventsSettings.lastXYById[l];a.msReleasePointerCapture?a.msReleasePointerCapture(l):"mouseup"==g.type&&0==b.NumberOfKeys(b.opts.eventsSettings.lastXYById)&&(b.opts.eventsSettings.useSetReleaseCapture?a.releaseCapture():(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",d,!1)))}}}}var b=this;if(window.navigator.msPointerEnabled)a.addEventListener("MSPointerDown",d,!1),a.addEventListener("MSPointerMove",d,!1),a.addEventListener("MSPointerUp",
d,!1),a.addEventListener("MSPointerCancel",d,!1),"undefined"!=typeof a.style.msContentZooming&&(a.style.msContentZooming="none"),"undefined"!=typeof a.style.msTouchAction&&(a.style.msTouchAction="none"),b.opts.debug&&c("<div>").html("Using Microsoft pointer model").prependTo(b.opts.debug);else if(a.addEventListener)a.addEventListener("touchstart",d,!1),a.addEventListener("touchmove",d,!1),a.addEventListener("touchend",d,!1),a.addEventListener("touchcancel",d,!1),a.addEventListener("mousedown",d,!1),
a.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(this.opts.eventsSettings.useSetReleaseCapture=!0,a.addEventListener("mousemove",d,!1),a.addEventListener("mouseup",d,!1)),b.opts.debug&&c("<div>").html("Using mouse model with capture").prependTo(b.opts.debug);else if(a.attachEvent&&a.setCapture)opts.eventsSettings.useSetReleaseCapture=!0,a.attachEvent("onmousedown",function(){d(window.event);return window.event.returnValue=!1}),a.attachEvent("onmousemove",function(){d(window.event);return window.event.returnValue=
!1}),a.attachEvent("onmouseup",function(){d(window.event);return window.event.returnValue=!1}),b.opts.debug&&c("<div>").html("Using legacy IE mode - mouse model with capture").prependTo(b.opts.debug);else return b.opts.debug&&c("<div>").html("Unexpected combination of supported features").prependTo(b.opts.debug),!1;var f,m;this.$el.data("obj",b);this.$el.trigger(b.opts.controlInitializedEventName);return!0};this.EnsurePageXY=function(a){if("undefined"==typeof a.pageX)if(a.pageX=a.offsetX+documentToTargetDelta.x,
a.pageY=a.offsetY+documentToTargetDelta.y,a.srcElement.offsetParent==target&&document.documentMode&&8==document.documentMode&&"mousedown"==a.type)a.pageX+=a.srcElement.offsetLeft,a.pageY+=a.srcElement.offsetTop;else if(a.srcElement!=target&&!document.documentMode||8>document.documentMode){for(var d=-2,b=-2,c=a.srcElement;null!=c;c=c.parentNode)d+=c.scrollLeft?c.scrollLeft:0,b+=c.scrollTop?c.scrollTop:0;a.pageX=a.clientX+d;a.pageY=a.clientY+b}};this.NumberOfKeys=function(a){if(Object.keys)return Object.keys(a).length;
var d=0,b;for(b in a)++d;return d};this.ComputeDocumentToElementDelta=function(a){for(var d=0,b=0;null!=a;a=a.offsetParent){if(!navigator.userAgent.match(/\bMSIE\b/)||document.documentMode&&!(8>document.documentMode)||!("relative"==a.currentStyle.position&&a.offsetParent&&"relative"==a.offsetParent.currentStyle.position&&a.offsetLeft==a.offsetParent.offsetLeft))d+=a.offsetLeft;b+=a.offsetTop}return{x:d,y:b}};this.changeItem=function(a){if(this.opts.busy)return!1;this.opts.busy=!0;this.opts.debug&&
(a?c("<div>").html("swipe left").prependTo(this.opts.debug):c("<div>").html("swipe right").prependTo(this.opts.debug));var d,b,f=this.getItem(this.opts.currentIndex);b=this.fixIndex(a?this.opts.currentIndex+1:this.opts.currentIndex-1);d=this.fixIndex(a?this.opts.currentIndex+2:this.opts.currentIndex+1);var e=this.getItem(b),g=2<this.totalNumberOfItems?this.getItem(d):void 0;if(!a&&e){e.css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent});var h=this.fixIndex(b-1),k=this.getItem(h);this.getItems().not(":eq("+
this.opts.currentIndex+")").not(":eq("+b+")").not(":eq("+h+")").hide();this.getItem(this.fixIndex(b-1)).css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent})}a&&g&&(g.css({left:2*this.opts._item_width+this.opts.itemsLeftMarginPercent}),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+d+")").hide());a={left:(a?"-=":"+=")+this.opts._item_width};e&&e.show();g&&g.show();var j=this;e&&e.animate(a,this.opts.animationDuration,this.opts.animationEasing,function(){j.opts.currentIndex=
b;j.opts.busy=!1;k&&k.show();j.$el.trigger(j.opts.selectedItemChangedEventName)});g&&g.animate(a,this.opts.animationDuration,this.opts.animationEasing);f.animate(a,this.opts.animationDuration,this.opts.animationEasing);this.getItemsContainer().animate({left:"0px"},this.opts.anumationDuration,this.opts.animationEasing);this.getTitle().animate({marginLeft:-b*this.opts.titleAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);this.$el.animate({backgroundPositionX:b*this.opts.backgroundAnimationStep+
"%"},this.opts.animationDuration,this.opts.animationEasing);return!0}}k.prototype={init:function(){var c=this.$el;if(c.data("panorama"))return!1;c.attr("data-panorama",!0);this.prepare(c);return!0},prepare:function(f){var e=f.parent().height();f.height(e);var h=this.getItemsContainer().position().top,a=e-h;this.getItemsContainer().height(a);this.totalNumberOfItems=this.getItems().length;var d=f.outerWidth()*(100-this.opts.itemsGapPercentage)/100;this.opts._item_width=d;f=Math.round(c(window).width()/
100*this.opts.itemsLeftMarginPercent);this.opts.itemsLeftMarginPercent=f;this.getItems().each(function(b,e){c(e).height(a-(c(e).outerHeight()-c(e).height()));c(e).width(d-(c(e).outerWidth()-c(e).width()));1==b&&c(e).css({left:d});1<b&&c(e).hide()});2<this.opts.totalNumberOfItems&&(this.getLastItem().css({left:"-"+d+"px"}).show(),this.getItems().css("left","+="+f+"px"))},show:function(){var f=this;this.getItemsContainer().fadeIn(function(){var e=f.getItemsContainer().position().top;f.getItems().each(function(){c(this).css("height",
"-="+e+"px")})})}};c.fn.panorama=function(f){this.length&&this.each(function(){var e=new k(this,f);e.init();e.setEvents(this);e.show();c(this).data("panorama",e)})}})(jQuery);$.easing.easeOutExpo=function(c,k,f,e,h){return k==h?f+e:e*(-Math.pow(2,-10*k/h)+1)+f};