/*
$.panorama version 1.0
by danyagrohman@gmail.com
*/
(function(c){function p(e,g){this.defaults={debug:!1,clickedWrapperClass:"ui-panorama-click-wrapper",clickedElementClass:"ui-panorama-clicked",animationDuration:500,animationEasing:"easeOutExpo",titleSelector:"h1",itemsContainerSelector:".ui-panorama-items",itemSelector:".ui-panorama-item",backgroundAnimationStep:0,titleAnimationStep:15,itemsGapPercentage:10,itemsLeftMarginPercent:0,totalNumberOfItems:0,controlInitializedEventName:"controlInitialized",selectedItemChangedEventName:"selectedItemChanged"};
if(!c(e).data("panorama")){c(e).css({"-ms-content-zooming":"none","-ms-touch-action":"none"});this.opts=c.extend({},this.defaults,g);this.opts=c.extend(this.opts,{currentIndex:0,busy:!1,_item_width:0,eventsSettings:{useSetReleaseCapture:!1,lastXYById:{},moved:0,yDirection:null},debug:!0==this.opts.debug&&c("<div>").css({position:"fixed",bottom:"0px",right:"0px",background:"white",border:"1px solid red",overflow:"hidden",width:"200px",height:"20%",zIndex:"9999",color:"black"}).appendTo("body")});0==
parseInt(this.opts.totalNumberOfItems)&&(this.opts.totalNumberOfItems=c(e).children(this.opts.itemsContainerSelector).children(this.opts.itemSelector).length);0==parseInt(this.opts.backgroundAnimationStep)&&(this.opts.backgroundAnimationStep=Math.round(100/this.opts.totalNumberOfItems));this.$el=c(e);c("<div>").addClass(this.opts.clickedWrapperClass).css({zIndex:9999,opacity:"0",width:c(window).width(),height:c(window).height(),position:"fixed",left:"0px",top:"0px",background:"black",overflow:"scroll"}).prependTo(this.$el);
if(this.opts.debug){var j=c("<div>").css({position:"fixed",bottom:"0px",left:"0px",background:"white",border:"1px solid red",color:"black"}).appendTo("body");c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToNext();\">swipe left</a>").appendTo(j);c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToPrevious();\">swipe right</a>").appendTo(j);c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goTo(3);\">go to screen 3</a>").appendTo(j);
c("<h2>").html('<a href="#" onclick="alert($(\'.'+this.$el.attr("class")+"').data('obj').opts.currentIndex);\">get current idx</a>").appendTo(j)}this.getItemsContainer=function(){return this.$el.children(this.opts.itemsContainerSelector)};this.getItems=function(){return this.getItemsContainer().children(this.opts.itemSelector)};this.getItem=function(b){return this.getItemsContainer().children(this.opts.itemSelector+":eq("+b+")")};this.getLastItem=function(){return this.getItem(this.opts.totalNumberOfItems-
1)};this.getTitle=function(){return this.$el.children(this.opts.titleSelector)};this.fixIndex=function(b){0>b?b+=this.opts.totalNumberOfItems:b>=this.opts.totalNumberOfItems&&(b-=this.opts.totalNumberOfItems);return b};this.getCurrentItem=function(){return this.getItems().eq(this.opts.currentIndex)};this.goTo=function(b){var c=this,d=setInterval(function(){c.opts.currentIndex==b?clearInterval(d):c.opts.currentIndex<b?c.goToNext():c.goToPrevious()},c.opts.animationDuration)};this.goToNext=function(){this.changeItem(!0)};
this.goToPrevious=function(){this.changeItem(!1)};this.setEvents=function(b){function e(a){if(Object.keys)return Object.keys(a).length;var b=0,c;for(c in a)++b;return b}function d(h){if(!("mousemove"==h.type&&0==e(a.opts.eventsSettings.lastXYById))){h.preventDefault&&h.preventDefault();h.preventManipulation&&h.preventManipulation();h.preventMouseEvent&&h.preventMouseEvent();for(var p=h.changedTouches?h.changedTouches:[h],t=0;t<p.length;++t){var q=p[t],n="undefined"!=typeof q.identifier?q.identifier:
"undefined"!=typeof q.pointerId?q.pointerId:1,f=q;if("undefined"==typeof f.pageX)if(f.pageX=f.offsetX+documentToTargetDelta.x,f.pageY=f.offsetY+documentToTargetDelta.y,f.srcElement.offsetParent==b&&document.documentMode&&8==document.documentMode&&"mousedown"==f.type)f.pageX+=f.srcElement.offsetLeft,f.pageY+=f.srcElement.offsetTop;else if(f.srcElement!=b&&!document.documentMode||8>document.documentMode){for(var r=-2,s=-2,k=f.srcElement;null!=k;k=k.parentNode)r+=k.scrollLeft?k.scrollLeft:0,s+=k.scrollTop?
k.scrollTop:0;f.pageX=f.clientX+r;f.pageY=f.clientY+s}f=q.pageX;q=q.pageY;if(h.type.match(/(start|down)$/i)){s=r=a.opts.eventsSettings.moved=0;for(k=b;null!=k;k=k.offsetParent){if(!navigator.userAgent.match(/\bMSIE\b/)||document.documentMode&&!(8>document.documentMode)||!("relative"==k.currentStyle.position&&k.offsetParent&&"relative"==k.offsetParent.currentStyle.position&&k.offsetLeft==k.offsetParent.offsetLeft))r+=k.offsetLeft;s+=k.offsetTop}documentToTargetDelta={x:r,y:s};if(a.opts.eventsSettings.lastXYById[n]){delete a.opts.eventsSettings.lastXYById[n];
a.opts.debug&&c("<div>").html("force end").prependTo(a.opts.debug);a.getItemsContainer().css({left:"0px"});break}a.opts.debug&&c("<div>").html("start at "+f+"px").prependTo(a.opts.debug);a.opts.eventsSettings.lastXYById[n]={x:f,y:q};g=f;j=q;b.msSetPointerCapture?b.msSetPointerCapture(n):"mousedown"==h.type&&1==e(a.opts.eventsSettings.lastXYById)&&(a.opts.eventsSettings.useSetReleaseCapture?b.setCapture(!0):(document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",d,!1)));c("."+
a.opts.clickedWrapperClass).hide();c(document.elementFromPoint(f,q)).addClass(a.opts.clickedElementClass);c("."+a.opts.clickedWrapperClass).show()}else if(h.type.match(/move$/i))void 0!==a.opts.eventsSettings.lastXYById[n]&&(a.opts.eventsSettings.lastXYById[n].x=f,a.opts.eventsSettings.lastXYById[n].y=q,l=f-g,m=j-q,mNewX=Math.abs(l),mNewY=Math.abs(m),n=30,30<mNewY&&mNewX<n?(0<m&&"up"!=a.opts.eventsSettings.yDirection?(m-=30,a.opts.eventsSettings.yDirection="down"):(m+=30,a.opts.eventsSettings.yDirection=
"up"),!1==a.opts.busy&&(m+=a.getItem(a.opts.currentIndex).scrollTop(),j+=a.getItem(a.opts.currentIndex).scrollTop()),a.opts.busy=!0,a.getItem(a.opts.currentIndex).scrollTop(m),a.opts.eventsSettings.moved=m,a.opts.debug&&c("<div>").html("going "+a.opts.eventsSettings.yDirection+": "+m).prependTo(a.opts.debug),l=0):mNewX>n?(0>l&&(n=-n),a.opts.eventsSettings.moved=l-n,a.opts.debug&&c("<div>").html("move: "+a.opts.eventsSettings.moved+"px").prependTo(a.opts.debug),!1==a.opts.busy&&a.getItemsContainer().css({left:a.opts.eventsSettings.moved+
"px"})):(m=l=0,a.opts.eventsSettings.moved=0));else if(a.opts.eventsSettings.lastXYById[n]&&h.type.match(/(up|end|cancel)$/i)){delete a.opts.eventsSettings.lastXYById[n];b.msReleasePointerCapture?b.msReleasePointerCapture(n):"mouseup"==h.type&&0==e(a.opts.eventsSettings.lastXYById)&&(a.opts.eventsSettings.useSetReleaseCapture?b.releaseCapture():(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",d,!1)));a.opts.debug&&c("<div>").html("end").prependTo(a.opts.debug);
null!=a.opts.eventsSettings.yDirection&&(a.opts.eventsSettings.yDirection=null,a.opts.busy=!1);var u=setInterval(function(){!1==a.opts.busy&&(clearInterval(u),0<l?(a.goToPrevious(),l=0):0>l&&(a.goToNext(),l=0))},10);setTimeout(function(){c("."+a.opts.clickedElementClass).each(function(){c(this).removeClass(a.opts.clickedElementClass);(0==a.opts.eventsSettings.moved||void 0===a.opts.eventsSettings.moved)&&c(this).click()});null==a.opts.eventsSettings.yDirection&&(a.opts.eventsSettings.moved=0)},100)}}}}
var a=this;if(window.navigator.msPointerEnabled)b.addEventListener("MSPointerDown",d,!1),b.addEventListener("MSPointerMove",d,!1),b.addEventListener("MSPointerUp",d,!1),b.addEventListener("MSPointerCancel",d,!1),"undefined"!=typeof b.style.msContentZooming&&(b.style.msContentZooming="none"),"undefined"!=typeof b.style.msTouchAction&&(b.style.msTouchAction="none"),a.opts.debug&&c("<div>").html("Using Microsoft pointer model").prependTo(a.opts.debug);else if(b.addEventListener)b.addEventListener("touchstart",
d,!1),b.addEventListener("touchmove",d,!1),b.addEventListener("touchend",d,!1),b.addEventListener("touchcancel",d,!1),b.addEventListener("mousedown",d,!1),b.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(this.opts.eventsSettings.useSetReleaseCapture=!0,b.addEventListener("mousemove",d,!1),b.addEventListener("mouseup",d,!1)),a.opts.debug&&c("<div>").html("Using mouse model with capture").prependTo(a.opts.debug);else if(b.attachEvent&&b.setCapture)a.opts.eventsSettings.useSetReleaseCapture=
!0,b.attachEvent("onmousedown",function(){d(window.event);return window.event.returnValue=!1}),b.attachEvent("onmousemove",function(){d(window.event);return window.event.returnValue=!1}),b.attachEvent("onmouseup",function(){d(window.event);return window.event.returnValue=!1}),a.opts.debug&&c("<div>").html("Using legacy IE mode - mouse model with capture").prependTo(a.opts.debug);else return a.opts.debug&&c("<div>").html("Unexpected combination of supported features").prependTo(a.opts.debug),!1;var g,
l,j,m;this.$el.data("obj",a);this.$el.trigger(a.opts.controlInitializedEventName);return!0};this.changeItem=function(b){if(this.opts.busy)return!1;this.opts.busy=!0;this.opts.debug&&(b?c("<div>").html("swipe left").prependTo(this.opts.debug):c("<div>").html("swipe right").prependTo(this.opts.debug));var e,d,a=this.getItem(this.opts.currentIndex);d=this.fixIndex(b?this.opts.currentIndex+1:this.opts.currentIndex-1);e=this.fixIndex(b?this.opts.currentIndex+2:this.opts.currentIndex+1);var g=this.getItem(d),
l=2<this.totalNumberOfItems?this.getItem(e):void 0,j,m;!b&&g&&(g.css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent}),3<this.totalNumberOfItems&&(j=this.fixIndex(d-1),m=this.getItem(j),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+d+")").not(":eq("+j+")").hide(),this.getItem(this.fixIndex(d-1)).css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent})));b&&l&&(l.css({left:2*this.opts._item_width+this.opts.itemsLeftMarginPercent}),this.getItems().not(":eq("+
this.opts.currentIndex+")").not(":eq("+e+")").hide());b={left:(b?"-=":"+=")+this.opts._item_width};var h=this;e=function(){h.opts.currentIndex=d;m&&m.show();h.opts.busy=!1;h.opts.eventsSettings.lastXYById={};h.$el.trigger(h.opts.selectedItemChangedEventName)};g&&g.show();l&&l.show();g&&g.animate(b,this.opts.animationDuration,this.opts.animationEasing,e);l&&l.animate(b,this.opts.animationDuration,this.opts.animationEasing);a.animate(b,this.opts.animationDuration,this.opts.animationEasing);this.getItemsContainer().animate({left:"0px"},
this.opts.anumationDuration,this.opts.animationEasing);this.opts.titleSelector&&this.getTitle().animate({marginLeft:-d*this.opts.titleAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);this.$el.animate({backgroundPositionX:d*this.opts.backgroundAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);return!0}}}p.prototype={init:function(){return this.$el?(this.$el.attr("data-panorama",!0),this.prepare(this.$el),!0):!1},prepare:function(e){var g=e.parent().height()+
1,j=this.getItemsContainer().position().top,b=g-j;e.height(b);this.getItemsContainer().height(b);this.totalNumberOfItems=this.getItems().length;var p=e.outerWidth()*(100-this.opts.itemsGapPercentage)/100;this.opts._item_width=p;e=Math.round(c(window).width()/100*this.opts.itemsLeftMarginPercent);this.opts.itemsLeftMarginPercent=e;this.getItems().each(function(d,a){c(a).height(b-(c(a).outerHeight()-c(a).height()));c(a).width(p-(c(a).outerWidth()-c(a).width()));1==d&&c(a).css({left:p});1<d&&c(a).hide()});
2<this.opts.totalNumberOfItems&&(this.getLastItem().css({left:"-"+p+"px"}).show(),this.getItems().css("left","+="+e+"px"))},show:function(){var e=this;this.getItemsContainer().fadeIn(function(){var g=e.getItemsContainer().position().top;e.getItems().each(function(){c(this).css("height","-="+g+"px")})})}};c.fn.panorama=function(e){this.length&&this.each(function(){var g=new p(this,e);g.init()&&(g.setEvents(this),g.show(),c(this).data("panorama",g))})}})(jQuery);
$.easing.easeOutExpo=function(c,p,e,g,j){return p==j?e+g:g*(-Math.pow(2,-10*p/j)+1)+e};