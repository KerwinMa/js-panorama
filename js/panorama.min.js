/*
$.panorama version 1.0
by danyagrohman@gmail.com
*/
(function(c){function n(e,f){this.defaults={debug:!1,animationDuration:500,animationEasing:"easeOutExpo",titleSelector:"h1",itemsContainerSelector:".ui-panorama-items",itemSelector:".ui-panorama-item",backgroundAnimationStep:0,titleAnimationStep:15,itemsGapPercentage:10,itemsLeftMarginPercent:0,totalNumberOfItems:0,controlInitializedEventName:"controlInitialized",selectedItemChangedEventName:"selectedItemChanged"};if(c(e).data("panorama"))return!1;this.opts=c.extend({},this.defaults,f);this.opts=
c.extend(this.opts,{currentIndex:0,busy:!1,_item_width:0,eventsSettings:{useSetReleaseCapture:!1,lastXYById:{},yDirection:null},debug:!0==this.opts.debug&&c("<div>").css({position:"fixed",bottom:"0px",right:"0px",background:"white",border:"1px solid red",overflow:"hidden",width:"200px",height:"20%",zIndex:"9999",color:"black"}).appendTo("body")});0==parseInt(this.opts.backgroundAnimationStep)&&(this.opts.backgroundAnimationStep=Math.round(100/c(e).find(this.opts.itemSelector).length));0==parseInt(this.opts.totalNumberOfItems)&&
(this.opts.totalNumberOfItems=c(e).find(this.opts.itemSelector).length);this.$el=c(e);if(this.opts.debug){var h=c("<div>").css({position:"fixed",bottom:"0px",left:"0px",background:"white",border:"1px solid red",color:"black"}).appendTo("body");c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToNext();\">swipe left</a>").appendTo(h);c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToPrevious();\">swipe right</a>").appendTo(h);
c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goTo(3);\">go to screen 3</a>").appendTo(h);c("<h2>").html('<a href="#" onclick="alert($(\'.'+this.$el.attr("class")+"').data('obj').opts.currentIndex);\">get current idx</a>").appendTo(h)}this.getItemsContainer=function(){return this.$el.children(this.opts.itemsContainerSelector)};this.getItems=function(){return this.getItemsContainer().children(this.opts.itemSelector)};this.getItem=function(a){return this.getItemsContainer().children(this.opts.itemSelector+
":eq("+a+")")};this.getLastItem=function(){return this.getItem(this.opts.totalNumberOfItems-1)};this.getTitle=function(){return this.$el.children(this.opts.titleSelector)};this.fixIndex=function(a){0>a?a+=this.opts.totalNumberOfItems:a>=this.opts.totalNumberOfItems&&(a-=this.opts.totalNumberOfItems);return a};this.getCurrentItem=function(){return this.getItems().eq(this.opts.currentIndex)};this.goTo=function(a){var d=this,b=setInterval(function(){d.opts.currentIndex==a?clearInterval(b):d.opts.currentIndex<
a?d.goToNext():d.goToPrevious()},d.opts.animationDuration)};this.goToNext=function(){this.changeItem(!0)};this.goToPrevious=function(){this.changeItem(!1)};this.setEvents=function(a){function d(g){if(!("mousemove"==g.type&&0==b.NumberOfKeys(b.opts.eventsSettings.lastXYById)))for(var f=g.changedTouches?g.changedTouches:[g],h=0;h<f.length;++h){var m=f[h],l="undefined"!=typeof m.identifier?m.identifier:"undefined"!=typeof m.pointerId?m.pointerId:1;b.EnsurePageXY(m);var n=m.pageX,m=m.pageY;if(g.type.match(/(start|down)$/i)){documentToTargetDelta=
b.ComputeDocumentToElementDelta(a);if(b.opts.eventsSettings.lastXYById[l]){delete b.opts.eventsSettings.lastXYById[l];b.opts.debug&&c("<div>").html("end").prependTo(b.opts.debug);break}b.opts.debug&&c("<div>").html("start at "+n+"px").prependTo(b.opts.debug);b.opts.eventsSettings.lastXYById[l]={x:n,y:m};p=n;e=m;a.msSetPointerCapture?a.msSetPointerCapture(l):"mousedown"==g.type&&1==b.NumberOfKeys(b.opts.eventsSettings.lastXYById)&&(b.opts.eventsSettings.useSetReleaseCapture?a.setCapture(!0):(document.addEventListener("mousemove",
d,!1),document.addEventListener("mouseup",d,!1)))}else if(g.type.match(/move$/i))void 0!==b.opts.eventsSettings.lastXYById[l]&&(b.opts.eventsSettings.lastXYById[l].x=n,b.opts.eventsSettings.lastXYById[l].y=m,j=n-p,k=e-m,10<Math.abs(k)?(wait=0,0<k&&"up"!=b.opts.eventsSettings.yDirection?(k-=20,b.opts.eventsSettings.yDirection="down"):b.opts.eventsSettings.yDirection="up",!1==b.opts.busy&&(k+=b.getItem(b.opts.currentIndex).scrollTop(),e+=b.getItem(b.opts.currentIndex).scrollTop()),b.opts.busy=!0,b.getItem(b.opts.currentIndex).scrollTop(k+
wait),b.opts.debug&&c("<div>").html("going "+b.opts.eventsSettings.yDirection).prependTo(b.opts.debug),j=0):(20<Math.abs(j)?(0>j&&(wait=-20),l=j-20,b.opts.debug&&c("<div>").html("move: "+l+"px").prependTo(b.opts.debug),b.getItemsContainer().css("left",l+"px")):j=0,k=0));else if(b.opts.eventsSettings.lastXYById[l]&&g.type.match(/(up|end|cancel)$/i)){b.opts.debug&&c("<div>").html("end").prependTo(b.opts.debug);0!=k&&(b.opts.eventsSettings.yDirection=null,b.opts.busy=!1,k=0);var q=setInterval(function(){!1==
b.opts.busy&&clearInterval(q);0<j?b.goToPrevious():0>j&&b.goToNext();j=0},10);delete b.opts.eventsSettings.lastXYById[l];a.msReleasePointerCapture?a.msReleasePointerCapture(l):"mouseup"==g.type&&0==b.NumberOfKeys(b.opts.eventsSettings.lastXYById)&&(0<j&&(g.preventDefault&&g.preventDefault(),g.preventManipulation&&g.preventManipulation(),g.preventMouseEvent&&g.preventMouseEvent()),b.opts.eventsSettings.useSetReleaseCapture?a.releaseCapture():(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",
d,!1)))}}}var b=this;if(window.navigator.msPointerEnabled)a.addEventListener("MSPointerDown",d,!1),a.addEventListener("MSPointerMove",d,!1),a.addEventListener("MSPointerUp",d,!1),a.addEventListener("MSPointerCancel",d,!1),"undefined"!=typeof a.style.msContentZooming&&(a.style.msContentZooming="none"),"undefined"!=typeof a.style.msTouchAction&&(a.style.msTouchAction="none"),b.opts.debug&&c("<div>").html("Using Microsoft pointer model").prependTo(b.opts.debug);else if(a.addEventListener)a.addEventListener("touchstart",
d,!1),a.addEventListener("touchmove",d,!1),a.addEventListener("touchend",d,!1),a.addEventListener("touchcancel",d,!1),a.addEventListener("mousedown",d,!1),a.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(this.opts.eventsSettings.useSetReleaseCapture=!0,a.addEventListener("mousemove",d,!1),a.addEventListener("mouseup",d,!1)),b.opts.debug&&c("<div>").html("Using mouse model with capture").prependTo(b.opts.debug);else if(a.attachEvent&&a.setCapture)opts.eventsSettings.useSetReleaseCapture=
!0,a.attachEvent("onmousedown",function(){d(window.event);return window.event.returnValue=!1}),a.attachEvent("onmousemove",function(){d(window.event);return window.event.returnValue=!1}),a.attachEvent("onmouseup",function(){d(window.event);return window.event.returnValue=!1}),b.opts.debug&&c("<div>").html("Using legacy IE mode - mouse model with capture").prependTo(b.opts.debug);else return b.opts.debug&&c("<div>").html("Unexpected combination of supported features").prependTo(b.opts.debug),!1;var p,
e,j,k;this.$el.data("obj",b);this.$el.trigger(b.opts.controlInitializedEventName);return!0};this.EnsurePageXY=function(a){if("undefined"==typeof a.pageX)if(a.pageX=a.offsetX+documentToTargetDelta.x,a.pageY=a.offsetY+documentToTargetDelta.y,a.srcElement.offsetParent==target&&document.documentMode&&8==document.documentMode&&"mousedown"==a.type)a.pageX+=a.srcElement.offsetLeft,a.pageY+=a.srcElement.offsetTop;else if(a.srcElement!=target&&!document.documentMode||8>document.documentMode){for(var d=-2,
b=-2,c=a.srcElement;null!=c;c=c.parentNode)d+=c.scrollLeft?c.scrollLeft:0,b+=c.scrollTop?c.scrollTop:0;a.pageX=a.clientX+d;a.pageY=a.clientY+b}};this.NumberOfKeys=function(a){if(Object.keys)return Object.keys(a).length;var c=0,b;for(b in a)++c;return c};this.ComputeDocumentToElementDelta=function(a){for(var c=0,b=0;null!=a;a=a.offsetParent){if(!navigator.userAgent.match(/\bMSIE\b/)||document.documentMode&&!(8>document.documentMode)||!("relative"==a.currentStyle.position&&a.offsetParent&&"relative"==
a.offsetParent.currentStyle.position&&a.offsetLeft==a.offsetParent.offsetLeft))c+=a.offsetLeft;b+=a.offsetTop}return{x:c,y:b}};this.changeItem=function(a){if(this.opts.busy)return!1;this.opts.busy=!0;this.opts.yDirection=null;this.opts.debug&&(a?c("<div>").html("swipe left").prependTo(this.opts.debug):c("<div>").html("swipe right").prependTo(this.opts.debug));var d,b,e=this.getItem(this.opts.currentIndex);b=this.fixIndex(a?this.opts.currentIndex+1:this.opts.currentIndex-1);d=this.fixIndex(a?this.opts.currentIndex+
2:this.opts.currentIndex+1);var f=this.getItem(b),j=2<this.totalNumberOfItems?this.getItem(d):void 0,k,g;!a&&f&&(f.css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent}),3<this.totalNumberOfItems&&(k=this.fixIndex(b-1),g=this.getItem(k),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+b+")").not(":eq("+k+")").hide(),this.getItem(this.fixIndex(b-1)).css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent})));a&&j&&(j.css({left:2*this.opts._item_width+this.opts.itemsLeftMarginPercent}),
this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+d+")").hide());a={left:(a?"-=":"+=")+this.opts._item_width};f&&f.show();j&&j.show();var h=this;f&&f.animate(a,this.opts.animationDuration,this.opts.animationEasing,function(){h.opts.currentIndex=b;h.opts.busy=!1;g&&g.show();h.$el.trigger(h.opts.selectedItemChangedEventName)});j&&j.animate(a,this.opts.animationDuration,this.opts.animationEasing);e.animate(a,this.opts.animationDuration,this.opts.animationEasing);this.getItemsContainer().animate({left:"0px"},
this.opts.anumationDuration,this.opts.animationEasing);this.opts.titleSelector&&this.getTitle().animate({marginLeft:-b*this.opts.titleAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);this.$el.animate({backgroundPositionX:b*this.opts.backgroundAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);return!0}}n.prototype={init:function(){return this.$el?(this.$el.attr("data-panorama",!0),this.prepare(this.$el),!0):!1},prepare:function(e){var f=e.parent().height()+
1,h=this.getItemsContainer().position().top,a=f-h;e.height(a);this.getItemsContainer().height(a);this.totalNumberOfItems=this.getItems().length;var d=e.outerWidth()*(100-this.opts.itemsGapPercentage)/100;this.opts._item_width=d;e=Math.round(c(window).width()/100*this.opts.itemsLeftMarginPercent);this.opts.itemsLeftMarginPercent=e;this.getItems().each(function(b,e){c(e).height(a-(c(e).outerHeight()-c(e).height()));c(e).width(d-(c(e).outerWidth()-c(e).width()));1==b&&c(e).css({left:d});1<b&&c(e).hide()});
2<this.opts.totalNumberOfItems&&(this.getLastItem().css({left:"-"+d+"px"}).show(),this.getItems().css("left","+="+e+"px"))},show:function(){var e=this;this.getItemsContainer().fadeIn(function(){var f=e.getItemsContainer().position().top;e.getItems().each(function(){c(this).css("height","-="+f+"px")})})}};c.fn.panorama=function(e){this.length&&this.each(function(){var f=new n(this,e);f.init()&&(f.setEvents(this),f.show(),c(this).data("panorama",f))})}})(jQuery);
$.easing.easeOutExpo=function(c,n,e,f,h){return n==h?e+f:f*(-Math.pow(2,-10*n/h)+1)+e};